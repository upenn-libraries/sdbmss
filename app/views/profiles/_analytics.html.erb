<%= content_for :head do %>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<script>
  $(document).ready(function () {
    $.get(window.location.href + ".json", function (result) {
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        for (key in result) {            
          var confirms = 0, disputes = 0, records = 0;
          //console.log(result);
          var t = result[key].map( (r) => {
            if (r.qualifier == "confirm") confirms += 1;
            else if (r.qualifier == "dispute") disputes += 1;
            else records += 1;
            return [new Date(r.created_at.split('T')[0]), records, confirms, disputes]
          });
          t.unshift(['Year', 'Records', 'Confirms', 'Disputes']);
          if (t.length <= 1) {
            t.push([0,0,0,0]);
          }
          var data = google.visualization.arrayToDataTable(t);

          var options = {
            title: key,
            hAxis: {title: 'Year',  titleTextStyle: {color: '#000', fontSize: 20}, textStyle: {color: '#333399', fontSize: 10}},
            vAxis: {minValue: 0},
            isStacked: true,
            height: 500,
            width: 720,
            selectionMode: 'multiple',
            backgroundColor: {fill: "#f8f8f8", strokeWidth: 1},
            explorer: {}
          };

          var chart = new google.visualization.AreaChart(document.getElementById(key));
          chart.draw(data, options);          
        }
      }
    })
  });
</script>
<% end %>
<h3 class="text-center">User Behavior and Feedback</h3>
<!--
<table class="table table-responsive table-bordered text-center">
  <thead>
    <tr>
      <td></td>
      <td>Created</td>
      <td>Confirms</td>
      <td>Disputes</td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Names</td>
      <td><%# (n = Name.select(:id).where(created_by: @user)).count %></td>
      <td><%# Rating.where(ratable_type: Name, qualifier: 'confirm', ratable_id: n.map(&:id)).count %></td>
      <td><%# Rating.where(ratable_type: Name, qualifier: 'dispute', ratable_id: n.map(&:id)).count %></td>
    </tr>
    <tr>
      <td>Links</td>
      <td><%# (em = EntryManuscript.select(:id).where(created_by: @user)).count %></td>
      <td><%# Rating.where(ratable_type: EntryManuscript, qualifier: 'confirm', ratable_id: em.map(&:id)).count %></td>
      <td><%# Rating.where(ratable_type: EntryManuscript, qualifier: 'dispute', ratable_id: em.map(&:id)).count %></td>
    </tr>
    <tr>
      <td>Personal Observations</td>
      <td><%# (p = Entry.joins(:source).select(:id).where({created_by: @user, :sources => {:source_type_id => 4}})).count %></td>
      <td><%# Rating.where(ratable_type: Entry, qualifier: 'confirm', ratable_id: p.map(&:id)).count %></td>
      <td><%# Rating.where(ratable_type: Entry, qualifier: 'dispute', ratable_id: p.map(&:id)).count %></td>
    </tr>
  </tbody>
</table>-->
<div id="Names" style="width: 100%; height: 500px; margin-bottom: 10px;"></div>
<div id="Links" style="width: 100%; height: 500px; margin-bottom: 10px;"></div>
<div id="Observations" style="width: 100%; height: 500px; margin-bottom: 10px;"></div>