<% content_for :head do %>
<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<style>
  .grid-item { 
    width: 350px; 
    margin-top: 10px;
    margin-bottom: 0px;
   }
  .grid-item .document {
    padding: 5px;
  }
</style>
<% end %>

<div ng-controller="ManageBookmarks">
<div class="row">
  <div class="col-sm-8">
    <h2 class="h2">My Bookmarks
    </h2>
    <p>This page shows the <b>Entries</b>, <b>Sources</b>, <b>Manuscript Records</b>, and <b>Name Authority Records</b> you have bookmarked. You can tag records with keywords by clicking on the "Add Tag" button at the bottom of each Bookmark display. Your tags will also appear in your dashboard for easy retrieval of tagged records.</p>
    <h5>How to create a Bookmark:</h5>
    <ol>
      <li>
        Click the Bookmark icon where it appears in an <b>Entry</b>, <b>Source</b>, <b>Manuscript Record</b>, or <b>Name Authority Record</b>.
      </li>
      <li>
        To view your bookmarks, click the <b>Bookmarks</b> icon in the top-horizontal navigation bar. You must be logged in to view your bookmarks.
      </li>
    </ol>
  </div>
  <div class="col-sm-4 text-right">
    <div class="form-inline clearfix navbar-form">
      <h3>Filter By Tag</h3>
      <span class="input-group">
        <input type="text" class="form-control" name="tag-search" placeholder="Filter By Tag..." size=12 ng-model="tagSearch" ng-keyup="$event.keyCode == 13 && searchTag(tagSearch)">
        <a href="" class="input-group-addon" ng-click="searchTag('')"><span>Clear</span></a>
      </span>
    </div>
  </div>
</div>
<div class="row" ng-repeat="(name, bookmarks) in all_bookmarks_display" style="border-bottom: 1px dotted #eee; padding: 10px 0px;">
  <div class="col-sm-12">
    <div class="grid">
  <div class="grid-item panel panel-default panel-preview">
    <div class="panel-body">
      <span class='h3' data-toggle="collapse" href="#bookmarks_{{name}}">{{ name }}(s)</span><br>
      <small class="text-muted">{{ bookmarks.length }} bookmarked</small><br>
      <a href="" ng-click="exportBookmarks(name, bookmarks[0].link)"><span class="glyphicon glyphicon-floppy-save" title="Export to CSV" ></span> Export to CSV</a>
    </div>
  </div>
  <div class="grid-item panel panel-default panel-preview" ng-repeat="bookmark in bookmarks">
    <div class="panel-heading">
      <strong class="h3"><a href="{{ bookmark.link }}">{{ bookmark.public_id }}</a></strong>
      <div class="pull-right">
          <a class='remove-bookmark control-bookmark' ng-click="removeBookmark(name, bookmark)">
            <span class="glyphicon glyphicon-remove"></span>
          </a>
      </div>
    </div>
    <div class="panel-body">
      <dl class="document-metadata">
        <dt ng-repeat-start="(key, value) in bookmark.details track by $index">{{ key }}</dt>
        <dd ng-repeat-end>{{ value }}</dd>
        <dt>
          Tags
        </dt>
        <dd>
          <ul class="list-inline">
            <li ng-if="bookmark.tags.length <= 0" class='text-warning'>This bookmark has no tags.</li>
            <li ng-repeat="tag in bookmark.tags" class="bookmark-tag" ng-class="{'btn-info btn-lg' : tag == search_tag, 'bg-primary' : tag != search_tag}">
                <a href="" ng-click="searchTag(tag);">{{ tag }}</a> <!-- fix me: should this filter in bookmark panel, or go to manage bookmarks search? -->
                <a href="" class='remove-bookmark-tag-confirm small' ng-click="removetag(bookmark, tag)"><span class="glyphicon glyphicon-remove"></span></a>
            </li>
            <li>
              <a ng-show="!bookmark.showAddTag" href="" class="btn btn-sm btn-success" ng-click="bookmark.showAddTag = !bookmark.showAddTag">Add Tag <span class="glyphicon glyphicon-tag"></span></a>
              <div class="form-inline">
                <div class="input-group add-bookmark-tag" ng-show="bookmark.showAddTag">
                  <input type='text' class='form-control' placeholder="add tag..." ng-model="bookmark.newtag" ng-keyup="$event.keyCode == 13 && addtag(bookmark, bookmark.newtag)">
                  <a href="" class="input-group-addon add-bookmark-tag-confirm" ng-click="addtag(bookmark, bookmark.newtag)"><span class="glyphicon glyphicon-plus"></span></a>
                  <a href="" class="input-group-addon add-bookmark-tag-confirm" ng-click="bookmark.showAddTag = !bookmark.showAddTag">Cancel</a>
                </div>
              </div>
            </li>
          </ul>
        </dd>
      </dl>
    </div>
  </div>
  <div class="grid-item panel panel-default panel-preview text-muted" ng-show="bookmarks.length <= 0">
      <div class="panel-body">
        <dl class="document-metadata">
            <dt></dt>
            <dd>
              No <strong>{{ name }} Records</strong> to display.
            </dd>
        </dl>
      </div>
  </div>
    </div>
  </div>
</div>
</div>