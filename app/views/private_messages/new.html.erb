<%= render partial: "header", locals: {title: @user ? "NEW MESSAGE TO #{@user}" : "NEW MESSAGE"} %>

<div class="panel panel-default">
  <div class="panel-body">
    <div class='h4'>
      <% if not @user %>
        Please select a user to send a message to.
      <% end %>
    </div>
    <% if @message %>
      <%= form_for(@message, html: {class: ''}) do |f| %>
        <%= hidden_field_tag :to_user, @user.id %>
        <div class="form-group row">
          <div class="col-sm-12">
            <%= f.text_field :title, class: "form-control", required: true, placeholder: "Title..." %>
          </div>        </div>
        <div class="form-group row">
          <div class="col-sm-12">
            <%= f.text_area :message, class: "form-control", rows: 5, required: true, placeholder: "Message..." %>
          </div>
        </div>
        <div class="form-group row">          
          <div class="col-sm-10"></div>
          <div class="col-sm-2 text-right">
            <%= f.submit 'SEND', class: 'btn btn-default btn-lg' %>
          </div>
        </div>
      <% end %>
    <% else %>
      <%= form_tag({:controller => "private_messages", :action => "new"}, :method => "get", class: 'form-inline') do %>
        <%= select_tag(:user_id, options_for_select(User.all.collect { |u| [u.username, u.id] }), {prompt: 'Select User', class: 'form-control'}) %>
        <%= submit_tag('Select', class: 'form-control') %>
      <% end %>
    <% end %>
  </div>
</div>