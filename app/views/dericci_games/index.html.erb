<% content_for :head do %>
  <style>
    .huge {
      font-size: 72px;
      color: #222;
      line-height: 54px;
      letter-spacing: -2px;
      font-weight: bold;
    }
    .stats {
      font-size: 32px;
      line-height: 30px;
      color: darksalmon;
      font-weight: bold;
      font-variant: small-caps;
    }
    .btn-special {
      width: 100%;
      height: 100%;
      font-size: 72px;
      line-height: 56px;
      padding-bottom: 15px;
      color: white;
      background: #333;
      border: none;
    }
    .btn-special-sm {
      font-size: 14px;
      line-height: 14px;
      padding-bottom: 4px;
    }
  </style>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {

      var data = google.visualization.arrayToDataTable([
        ['Description', 'Proportion'],
        ['Possibly Linked (<%= possible = DericciRecord.where({verified_id: nil, flagged: false}).joins(:dericci_links).group('dericci_records.id').count.count %>)', <%= possible %>],
        ['Definitely Linked (<%= definite = DericciRecord.where.not(verified_id: nil).where(flagged: false).count %>)',  <%= definite %>],
        ['In Progress (<%= flagged = DericciRecord.where(flagged: true).count %>)', <%= flagged %> ],
        ['Unlinked (<%= unlinked = DericciRecord.count - (flagged + definite + possible) %>)', <%= unlinked %>],
        //['Sleep',    7]
      ]);

      var options = {
        title: 'The De Ricci Digitized Archive',
        colors: ["#AE9A4A", "#AE724A", "#7F8FA8", "#306F63"],
        titleTextStyle: { 
          color: "#222",
          fontName: "Sarala",
          fontSize: 28,
          bold: true,
          italic: false 
        },
        pieHole: 0.3,
        legend: {
          alignment: "center",
          position: "right",
          textStyle: {
            color: "#222",
            fontName: "Sarala",
            fontSize: 14,
            bold: false,
            italic: true           
          }
        }
      };

      var chart = new google.visualization.PieChart(document.getElementById('piechart'));

      chart.draw(data, options);
    }
  </script>
<% end %>

<% content_for :breadcrumbs do %>
  <%= render partial: "breadcrumbs" %>
<% end %>
<div class="row">
  <div class="col-sm-7">
    <div id="piechart" style="width: 100%; height: 500px;"></div>
  </div>
  <div class="col-sm-5 text-center">
    <h3>My Games</h3>
    <table class="table table-responsive" style="height: 300px; overflow-y: scroll;">
      <tbody>
        <% if @games.reverse.each do |game| %>
          <tr>
            <td>
              <%= link_to(dericci_game_path(game), class: 'btn btn-default btn-xs') do %>
                <span class="glyphicon glyphicon-tower"></span>  <%= game.created_at.to_formatted_s(:long) %>
              <% end %>
            </td>
            <td>
              <div class="progress">
                <div class="progress-bar progress-bar-success" role="progressbar" style="width:<%= game.completed.to_i %>%;">
                  <%= game.completed.to_i %>% Completed
                </div>
                <div class="progress-bar progress-bar-warning" role="progressbar" style="width:<%= game.skipped.to_i %>%;">
                  <%= game.skipped.to_i %>% Skipped
                </div>
                <div class="progress-bar progress-bar-danger" role="progressbar" style="width:<%= game.flagged.to_i %>%;">
                  <%= game.flagged.to_i %>% Flagged
                </div>
                <% if game.skipped.to_i + game.completed.to_i <= 0 %>
                  <span class="text-muted">Not started</span>
                <% end %>
              </div>
            </td>
          </tr>
        <% end.empty? %>
          <tr>
            <td colspan="3" class="text-center text-muted">You have not played any games yet.</td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <a href="/dericci_games/new" class="btn btn-default btn-lg text-center" style="width: 100%">
      <span class="glyphicon glyphicon-tower"></span> New Game
    </a>
  </div>
  <div class="col-sm-12">
    <div class="text-center huge">KEEP PLAYING!</div>
  </div>
</div>