<form action="" id="place-form" class="form-horizontal sdbmss-form" ng-controller="PlaceCtrl" data-ng-cloak>
  <% if @model.id %>
    <input type="hidden" id="place_id" value="<%= @model.id %>">
  <% end %>
  <div class="field form-group row">
    <label for="" class="control-label col-sm-2">Name</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" ng-model="place.name">
    </div>
  </div>
  <div class="field form-group row">
    <label for="" class="control-label col-sm-2">Latitude</label>
    <div class="col-sm-4">
      <input type="text" class="form-control" ng-model="place.latitude">
    </div>
    <label for="" class="control-label col-sm-2">Longitude</label>
    <div class="col-sm-4">
      <input type="text" class="form-control" ng-model="place.longitude">
    </div>
  </div>
  <div class="field form-group row">
    <label for="" class="control-label col-sm-2">Authority Source</label>
    <div class="col-sm-4">
      <select name="" id="" class="form-control" ng-model="place.authority_source">
        <option value="http://vocab.getty.edu/tgn">Getty.edu</option>
        <option value="www.geonames.org">GeoNames.org</option>
      </select>
    </div>
    <label for="" class="control-label col-sm-2">
      Authority Id
    </label>
    <div class="col-sm-4">
      <div class="input-group">
        <div class="input-group-btn">
          <a href="" class="btn btn-default" ng-click="queryAuthority()" ng-disabled="place.authority_source != 'http://vocab.getty.edu/tgn'">
            <span class="glyphicon glyphicon-globe"></span>
          </a>
        </div>
        <input type="text" class="form-control" ng-model="place.authority_id">
      </div>
    </div>
  </div>
  <div class="field form-group row">
    <label for="" class="control-label col-sm-2">Parent</label>
    <div class="col-sm-10">
      <a ng-show='place.parent.id == undefined' class="btn btn-add-name" ng-click="selectNameAuthorityModal(place.parent, 'place')">
        Find or Create Parent Place
      </a>
      <div ng-if='place.parent !== undefined && place.parent.id !== undefined' class="well well-sm well-name-authority">
          <a class="glyphicon glyphicon-remove" ng-click="removeNameAuthority(place, 'parent')"></a> <!-- remove name! -->
          <a href="/places/{{ place.parent.id }}" target="_blank">{{ place.parent.name }}</a>
      </div>
    </div>
  </div>
  <div class="field form-group row">
    <div class="col-sm-2"></div>
    <div class="col-sm-10 text-center"><a href="" ng-click="save()" class="btn btn-primary">Save</a></div>
  </div>
</form>

<%= render "shared/create_entity_with_name" %>
<%= render "shared/select_model_authority" %>
<script type="text/ng-template" id="queryGetty.html">
    <div class="modal-header">
      <h3 class="modal-title text-center">Find {{ place.name }} in Getty TGN Vocab</h3>
    </div>

    <div class="modal-body form-horizontal compress-whitespace fit-screen">
      <table class="table">
        <thead>
          <tr>
            <th></th>
            <th>Name</th>
            <th>Ancestors</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="result in suggestions.data.results.bindings" ng-init="result.uri = result.Subject.value.split('/')[result.Subject.value.split('/').length - 1]">
            <td><a ng-click="setAuthorityId(result)" class='btn btn-xs btn-default'>Select {{ result.uri }}</a></td>
            <td><a href="{{ result.Subject.value }}" target="_blank">{{ result.Term.value }}</a></td>
            <td><a href="{{ result.Parent.value }}" target="_blank">{{ result.Parents.value.split(", ")[0] }}</a>, {{ result.Parents.value.split(", ").slice(1,1000).join(", ") }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="modal-footer text-right">
      <a class="btn btn-default" ng-click="modal.close()">Cancel</a>
    </div>
</script>
