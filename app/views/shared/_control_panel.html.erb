<div id="control-panel">
  <div class="bookmarks-collapse collapse width in">
    <% if current_user %>
    <div class="panel panel-default">
        <div class="panel-heading" style="white-space: nowrap">
            <div class="user-icon">
              <span class="glyphicon glyphicon-user"></span>
            </div>
            <div class="user-info">
              <span class="dropdown">
                <a href="" class="dropdown-toggle" data-toggle="dropdown">
                  <%= current_user.to_s %>
                  <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                  <li><a href="<%= profile_path(username: current_user.username) %>"><span class="glyphicon glyphicon-user"></span> My Profile</a></li>
                  <li><a href="<%= private_messages_path %>"><span class="glyphicon glyphicon-envelope"></span> My Messages</a></li>
                  <li><%= link_to edit_user_registration_path do %> <span class="glyphicon glyphicon-cog"></span> My Settings <% end %></li>
                  <% if current_user && !current_user.to_s.blank? %>
                    <li>
                      <%= link_to(destroy_user_session_path, :onclick => "localStorage.clear();") do %>
                        <span class="glyphicon glyphicon-log-out"></span> <%= t('blacklight.header_links.logout') %>
                      <% end %>
                    </li>
                  <% end %>
                </ul>
              </span><br>
              <span class="text-muted" sdbm-tooltip="user_levels">User Level: <em><%= current_user.role %></em></span>
            </div>
        </div>
        <div class="panel-body">
          <ul class="nav">
            <%= render partial: "nav/notifications" %>
            <li>
              <a href="<%= dashboard_path %>"><span class="glyphicon glyphicon-dashboard"></span> Dashboard</a>
            </li>
            <li>
                <a href="/bookmarks"><span class="glyphicon glyphicon-bookmark"></span> Bookmarks</a>
            </li>
            <li>
                <a href="/downloads"><span class="glyphicon glyphicon-export"></span> Exports</a>
            </li>
            <li>
                <a href="/groups"><span class="glyphicon glyphicon-globe"></span> Groups</a>
            </li>          
            <li>
                <a href="/watches"><span class="glyphicon glyphicon-eye-open"></span> Watched Records</a>
            </li>
          </ul>
        </div>
    </div>

    <div class="control-panel-top">
      <div class="panel panel-default show-tools">
        <div class="panel-heading"><span class="h4">Tools</span></div>
        <div class="panel-body">
          <ul class="nav">
            <% if content_for? :add_entry %>
              <!--<li class="divider"></li>-->
              <%= yield :add_entry %>
            <% else %>
            <li class="dropdown">
              <a href="" data-toggle="dropdown"><span class="glyphicon glyphicon-plus"></span> Add New Entry <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li>
                  <a href="/entries/new">From a Source</a>
                </li>
                <li>
                  <%= link_to "Based on Personal Observation", new_source_path({create_entry: 1, source_type: 4}) %>
                </li>
              </ul>
            </li>
            <% end %>
            <%= yield :control_tools %>
          </ul>
        </div>
      </div>
    </div>
  <% end %>
  <!-- about and help; by default are collapsed when user is logged in -->
    <div class="panel-default panel">
      <div class="panel-heading one-line" data-toggle='collapse' data-target='#control-panel-about'>
        <span class="h4">
          <span class="glyphicon glyphicon-info-sign"></span>
            About Us
            <span class="caret"></span>
        </span>
      </div>
      <div id="control-panel-about" class="panel-collapse collapse <%= current_user ? '' : 'in' %>">
        <ul class="nav">
          <% Page.where(category: 'about').each do |page| %>
            <li><%= link_to page.name, page_path(page.name) %></li>
          <% end %>
        </ul>
      </div>
    </div>
    <div class="panel-default panel">
      <div class="panel-heading one-line" data-toggle='collapse' data-target='#control-panel-help'>
        <span class="h4">
          <span class="glyphicon glyphicon-question-sign"></span>
            Help
            <span class="caret"></span>
        </span>
      </div>
      <div id="control-panel-help" class="panel-collapse collapse <%= current_user ? '' : 'in' %>">
        <ul class="nav">
          <% Page.where(category: 'help').each do |page| %>
            <li><%= link_to page.name, page_path(page.name) %></li>
          <% end %>
          <li><a href="https://www.youtube.com/channel/UCsVZp-1724xPIW8MwIdKoyg/videos">Video Tutorials</a></li>
          <li><a href="mailto:sdbm@pobox.upenn.edu">Email Us</a></li>
        </ul>
      </div>
    </div>
    <% if !current_user %>
    <div class="panel panel-default">
      <div class="panel-heading one-line">
        <span class="h4">
          <span class="glyphicon glyphicon-log-in"></span> Login
        </span>
      </div>
      <div class="panel-body" style="padding: 10px;">
        <%= render partial: 'devise/sessions/new', locals: {resource: User.new, resource_name: 'user', devise_mapping: Devise.mappings[:user]} %>      
        <%= link_to "Sign up", new_registration_path('user') %><br />
        <%= link_to "Forgot your password?", new_password_path('user') %><br />
      </div>
    </div>
    <% end %>
  </div>
</div>