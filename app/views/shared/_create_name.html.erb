<!-- MODAL for creating a new (Person) Name Authority record from within create/edit source or entry -->

<script type="text/ng-template" id="createName.html">
    <div class="modal-header">
        <h3 class="modal-title">Create {{ entityName }}
            <a href="" class="btn btn-default pull-right" ng-click="goBack()"><span class="glyphicon glyphicon-circle-arrow-left"></span> Go Back</a>
        </h3>
    </div>
    <div class="modal-body form-horizontal compress-whitespace">

        <div class="row">
            <div class="col-sm-12">
                <%= render partial: "pages/partial", locals: {page_name: "Name Instructions" } %>
            </div>
        </div>

        <div class="form-group row">
            <label class="col-sm-2 control-label" sdbm-tooltip="create_name_name">Name</label>
            <div class="col-sm-5">
                <input type="text" name="name" class="form-control" ng-model="entity.name">
            </div>
            <div class="col-sm-3">
                <button ng-click="findSuggestions(entity.name)" ng-disabled="loading" class="btn btn-primary">Find Suggestions in VIAF</button>
            </div>
            <div class="col-sm-1">
                <img id="spinner" alt="working..." src="<%= asset_path "spinner.gif" %>" ng-show="loading"/>
            </div>
        </div>

        <div class="form-group row" ng-show="hasViafId">
            <label class="col-sm-2 control-label" sdbm-tooltip="create_name_viaf">VIAF ID</label>
            <div class="col-sm-2">
                <input type="text" class="form-control" ng-model="entity.viaf_id">
            </div>
        </div>

        <div class="form-group row">
            <label for="subtype" class="col-sm-2 control-label" sdbm-tooltip="edit_name_subtype">Subtype</label>
            <div class="col-sm-4">
                <%= select_tag(:subtype, options_for_select([['Unknown', 'Unknown'], ['Organization', 'Corporate'], ['Person', 'Personal']]), {'ng-model' => 'entity.subtype', class: "form-control", 'ng-init' => "entity.subtype='Unknown'"}) %>
            </div>
        </div>

        <div class="form-group row" ng-show="hasViafId">
            <label class="col-sm-2 control-label" sdbm-tooltip="create_name_other">Other Info</label>
            <div class="col-sm-7">
                <input type="text" class="form-control" ng-model="entity.other_info">
            </div>
        </div>

        
        <div ng-show="showSuggestions">
            <table ng-show="suggestions.length > 0" class="table table-striped table-compressed">
                <thead>
                    <tr>
                        <th class="col-sm-6"><b>Name</b></th>
                        <th class="col-sm-2"><b>VIAF ID</b></th>
                        <th class="col-sm-2"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ng-repeat="suggestion in suggestions">
                        <td class="col-sm-6">{{ suggestion.name }}</td>
                        <td class="col-sm-2"><a target="_blank" href="http://viaf.org/viaf/{{ suggestion.viaf_id }}/">{{ suggestion.viaf_id }}</a></td>
                        <td class="col-sm-2"><a ng-click="useSuggestion(suggestion)" href="">Use this info</a></td>
                    </tr>
                </tbody>
            </table>
            <div ng-show="!loading && suggestions.length == 0">No suggestions found.</div>
        </div>

        <p ng-show="message">{{ message }}</p>

        <p ng-repeat="e in errors track by $index" ng-if="errors.length > 0">
            Error: {{ e.message }} <a class='btn btn-success' ng-if="e.name && e.name.name" ng-click="useExisting(e.name)">Use {{ e.name.name }}</a>
        </p>
        
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary create-name-button" ng-click="save()" ng-show="readyToCreate" id='save-propose-name'>Create</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>