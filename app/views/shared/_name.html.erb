<%# Partial used to display name details for both Names generically and Agents (which are Names) %>
<div class="row">
    <div class="col-sm-3">
        <div class="panel panel-default show-tools">
            <div class="panel-heading">
                Tools
            </div>
            <div class="panel-body">
                <ul class="nav">
                    <% if user_signed_in? %>
                        <li>
                            <a onclick="addBookmark(<%= @model.id %>, 'Name');" class="bookmark-link" in_bookmarks="/names/<%= @model.id %>"><span class="glyphicon glyphicon-bookmark"></span></a>
                        </li>
                        <% if can?(:edit, name) %>
                            <li class="edit_name">
                                <a href="<%= edit_name_path(name.id) %>">Edit this name agent</a>
                            </li>
                        <% end %>
                        <li class="history"><a href="<%= history_name_path(name.id) %>">View change history</a></li>
                        <li class="link"><a href="<%= names_path %>">Return to list</a></li>
                        <li class="link"><a href="<%= merge_name_path(name.id) %>">Merge</a></li>
                    <% end %>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-sm-9">
        

        <% if !name.reviewed %>
        <div class="row">
            <div class="col-sm-12">
                NOTE: This name record was recently created and has not yet been reviewed.
            </div>
        </div>
        <% end %>

        <dl class="document-show-heading dl-horizontal dl-invert">
            <dt></dt>
            <dd class='h2'><%= name.public_id %></dd>
        </dl>
        <%= render partial: "shared/name_main", locals: { name: name } %>

    </div>
    <div class="col-sm-3"></div>
    <div class="col-sm-9">
        
        <h4>Share additional information about this name in the box below. Your comments will be displayed publicly.</h4>

        <% if (comments = name.comments.where(public: true)).present? %>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th class="col-sm-12" colspan="2"><b>Comments</b></th>
                </tr>
            </thead>
            <tbody>
                <% comments.each do |comment| %>
                <tr>
                    <td class="col-sm-2 text-right record-label">
                        By <%= render partial: "shared/username_with_profile_link", locals: { user: comment.created_by } %><br/>
                        At <%= comment.created_at.to_formatted_s(:date_and_time) %>
                    </td>
                    <td class="col-sm-10">
                        <%= comment.comment||"(none)" %>
                    </td>
                </tr>
                <% end %>
            </tbody>
        </table>
        <% end %>

        <% if user_signed_in? %>
            <% comment = Comment.new %>
            <% name_comment = comment.name_comments.build %>
            <% name_comment.name_id = name.id %>
            <%= form_for(comment, format: :json) do |f| %>
                <input type="hidden" name="return_url" value="<%= name_path name %>"/>
                <%= f.fields_for :name_comments do |name_comment| %>
                    <%= name_comment.hidden_field :name_id %>
                    <% end %>
                <div class="row">
                    <div class="col-sm-12 form-group">
                        <h4>Leave a comment</h4>
                        <%= f.text_area :comment, class: "form-control", rows: 5 %>
                    </div>
        <!--            <div class="col-sm-12 checkbox">
                        <label>
                            <%= f.check_box :is_correction %> I am leaving a comment that notes a correction to this record
                        </label>
                    </div>-->
                    <div class="col-sm-12 text-right">
                        <button class="btn btn-primary">Submit</button>
                    </div>
                </div>
            <% end %>
        <% end %>

        <div class="spacer-40px"></div>

    </div>

</div>
<script type="text/javascript">
$(document).ready(function() {

$("#new_comment").submit(function(event) {
     event.preventDefault();
     $.post($("#new_comment").attr("action"), $("#new_comment").serialize(), function() {
         window.location = "/names/" + <%= name.id %>;
     })
      .fail(function (jqXHR, textStatus, errorThrown) {
          var errorString = SDBM.parseRailsErrors($.parseJSON(jqXHR.responseText).errors).join("; ");
          alert(errorString);
      });
    });
});
</script>
