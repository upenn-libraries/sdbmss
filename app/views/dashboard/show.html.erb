<h1>Welcome, <%= current_user.username %>!</h1>

<p class="lead">This is your dashboard page, from which you can do some Very Useful Things.</p>

<div class="row">
    <div class="col-sm-3">
        <div class="panel panel-default">
            <div class="panel-heading">Stuff you can do</div>
            <div class="panel-body">
                <p><a href="<%= new_entry_path %>">Enter New Records</a></p>
                <p><a href="<%= admin_search_path %>">Manage Entries</a></p>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">Manage other data</div>
            <div class="panel-body">
                <p><a href="<%= sources_path %>">Manage Sources</a></p>
                <p><a href="<%= manuscripts_path %>">Manage Manuscripts</a></p>
                <p><a href="<%= names_path %>">Manage Names</a></p>
                <p><a href="<%= languages_path %>">Manage Languages</a></p>
                <p><a href="<%= places_path %>">Manage Places</a></p>
            </div>
        </div>
        <% if can? :manage, User %>
        <div class="panel panel-default">
            <div class="panel-heading">Admin</div>
            <div class="panel-body">
                <p><a href="<%= accounts_path %>">Manage Users</a></p>
            </div>
        </div>
        <% end %>
    </div>
    <div class="col-sm-9">
        <div class="panel panel-default">
            <div class="panel-heading">Entries You've Contributed</div>
            <div class="panel-body">
                <% num_entries = current_user.entries.count %>
                <% if num_entries > 0 %>
                <% num_entries_to_show = 5 %>
                <% entries = current_user.entries.most_recent(num_entries_to_show) %>
                <% search_url = search_advanced_url(created_by: current_user.to_s) %>
                <p>You've contributed <a href="<%= search_url %>"><%= num_entries %> entries</a> to date. The last <%= entries.count %> entries you created:</p>

                <table class="table">
                    <% entries.each do |entry| %>
                    <tr class="row">
                        <td class="col-sm-11"><a href="<%= entry_path(entry) %>"><%= entry.public_id %></a>: <%= entry.entry_titles.map(&:title).join("; ") %>
                          <% if !entry.approved %><em>(pending approval)</em><% end %>
                        </td>
                        <td class="col-sm-1"><a href="<%= edit_entry_path(entry) %>">edit</a></td>
                    </tr>
                    <% end %>
                    <% if num_entries > 5 %>
                    <tr class="row">
                        <td class="col-sm-11">
                            <a href="<%= search_url %>">View all...</a>
                        </td>
                        <td class="col-sm-1"></td>
                    </tr>
                    <% end %>
                </table>

                <% else %>

                <p>You haven't contributed any entries yet.</p>
                <% end %>
            </div>
        </div>

        <% num_sources = current_user.sources.count %>
        <% if num_sources > 0 %>
        <% num_sources_to_show = 5 %>
        <% sources = current_user.sources.most_recent(num_sources_to_show) %>
        <div class="panel panel-default">
            <div class="panel-heading">Sources You've Contributed</div>
            <div class="panel-body">
                  <p>You've contributed <%= num_sources %> sources to date. The last <%= sources.count %> sources you created:</p>

                  <table class="table">
                      <% sources.each do |source| %>
                      <tr class="row">
                          <td class="col-sm-9"><a href="<%= source_path(source) %>"><%= source.public_id %></a>: <%= source.display_value %></td>
                          <td class="col-sm-1"><a href="<%= edit_source_path(source) %>">edit</a></td>
                          <td class="col-sm-2"><a href="<%= new_entry_path(source_id: source) %>">add an entry</a></td>
                      </tr>
                      <% end %>
                  </table>
            </div>
        </div>
        <% end %>
    </div>
</div>
    

