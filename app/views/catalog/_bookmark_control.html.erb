<% if current_user %>
  <% if (w = current_user.bookmarks.where(document: document.model_object).first) %>
    <%= render partial: "bookmarks/delete", locals: {bookmark: w} %>
  <% else %>
    <%= render partial: "bookmarks/add", locals: {document: document.model_object}  %>
  <% end %>
  <script type='text/javascript'>
    $(document).ready(bindRemoteAjaxCallback);
    function bindRemoteAjaxCallback (){
      $('a[data-remote]').on('ajax:success', function (event, xhr, status, result) {
        $(this).replaceWith($(result.responseJSON.button));
        bindRemoteAjaxCallback();
      });

      $('a[data-remote]').on('ajax:error', function (event, xhr, status, error) {
        console.log("remote link (bookmark) error", event, xhr, status, error, xhr.responseText);
      });
    }
  </script>
<% end %>
