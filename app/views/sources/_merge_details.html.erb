<style>
    .to, .from {
        padding: 0px;
        overflow: hidden;
    }
    .merge_to, .merge_from {
        padding: 10px 15px;
        width: calc(100% + 30px);
    }
    .merge_from {
        background-color: #FFFEFA;
    }
    .merge_to {
        background-color: aliceblue;
    }
</style>
<div class='panel panel-primary'><!--<%= @target.present? ? "panel-warning" : "panel-primary" %>'>-->
    <div class='panel-heading'>
        <span class='h2'>Merge <%= @source.public_id %> &#10132; <%= @target.present? ? @target.public_id : "???" %></span>
    </div>
    <div class="panel-body">
        <% if @target.present? %>
        <div class="row">
            <div class="col-sm-12">
                <div><b>Confirm</b></div>
                <p>Are you sure you want to do this? <%= @source.public_id %> will be marked as deleted and its fields cleared out.</p>
            </div>
        <%= form_tag(request.path, method: :post, class: "form-horizontal sdbmss-form") do %>
            <input type="hidden" name="confirm" value="yes"/>
            <input type="hidden" name="target_id" value="<%= @target.id %>"/>
            <div class="col-sm-3">
                <button class="btn btn-primary">Yes</button>
                <a class="btn btn-warning" href="<%= sources_path %>">Cancel</a>
                <%= link_to "Swap", merge_source_path(@target, :target_id => @source.id), class: 'btn btn-info' %>
            </div>
        <% end %>
        </div>
    </div>
</div>


<div class="row">
    <ul class="list-group">
        <% @s_details.each do |f, v| %>
            <li class="list-group-item">
                <h4 class="list-group-item-headings"><%= f.to_s.humanize %></h4>
                <div class="row">
                    <div class="col-sm-6">
                        <%= @s_details[f][0] %>
                    </div>
                    <div class="col-sm-6">
                        <%= @t_details[f][0] %>                        
                    </div>
                </div>
            </li>
        <% end %>
    </ul>
</div>
<!--
<div class='row'>
    <div class='col-sm-6'>
        <div class='panel <%= @target.present? ? "panel-warning" : "panel-default" %> from'>
            <div class='panel-heading'><h4 class='h4'><%= @source.public_id %> <%= @target.present? ? " (Will be deleted)" : "" %></h4></div>
        </div>
    </div>
    <div class='col-sm-6'>
        
        <% if @target_id.present? && @target.present? %>
            <div class='panel <%= @target.present? ? "panel-info" : "panel-default" %> to'>
                <div class='panel-heading'><h4 class='h4'><%= @target.public_id %></h4></div>
            </div>
        <% else %>
            <% if @target_id.present? %>
                <div class='panel panel-danger'>
                <% if @warning.present? %>
                    <div class="panel-heading"><%= @warning %></div>
                <% else %>
                    <div class="panel-heading">Could not find record #<%= @target_id %></div>
                <% end %>
                </div>
            <% end %>
            <%= form_tag(request.path, method: :get, class: "form-horizontal sdbmss-form") do %>
                <div class="row">
                    <label class="col-sm-3 control-label">By Unique Id: </label>
                    <div class="col-sm-6">
                        <input type="text" name="target_id" class="form-control"></p>
                    </div>
                    <div class="col-sm-3">
                        <button class="btn btn-primary">Select</button>
                    </div>
                </div>
            <% end %>
            <div class='panel panel-default'>
                <% if @similar.present? %>
                    <div class='panel-heading'><b>Suggestions</b></div>
                    <table class='table table-striped'>
                        <thead>
                            <tr>
                                <th>Merge</th>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Date</th>
                                <th>Entries</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% @similar.each do |src| %>
                                <% if src.id != @source.id %>
                                <tr>
                                    <td><a class='btn btn-primary' href="<%= source_path(id: @source.id)%>/merge?target_id=<%= src.id %>">Select</a></td>
                                    <td><%= src.id %></td>
                                    <td><%= src.title %></td>
                                    <td><%= format_fuzzy_date(src.date) %></td>
                                    <td><a href="<%= search_advanced_path(source: src.public_id) %>"><%= src.entries.approved_only.count %> entries</a></td>
                                </tr>
                                <% end %>
                            <% end %>
                        </tbody>
                    </table>
                <% else %>
                    <h3>No suggested sources found, use manual search above.</h3>
                <% end %>
            </div>
        <% end %>
    </div>

</div>-->

<% end %>
<script type='text/javascript'>
$(document).ready( function () {
    $('.from.row').each( function (e) {
      var t = $(this);
      var a = $('<a class="overwrite btn btn-default btn-sm"><span class="glyphicon glyphicon-chevron-right"></span></a>');
      a.click( function (e) {
        var nt = t.parent('li').clone();
        nt.find('a.overwrite').remove();
        nt.addClass('list-group-item-warning');
        var dest = $('.to').find('.row[type=' + t.attr('type') + ']');
        dest.parent('li').replaceWith(nt);
        t.parent('li').addClass('disabled');
        //dest.hide();
      });
      t.parent('li').append(a);
    });
});
</script>